{{right_sidebar_enabled = 4}}
{{left_sidebar_enabled = 0}}
{{rightblocks = ['info']}}
{{response.title = T('Witnesses of Hope')}}
{{response.mobiletitle = response.title}}
{{response.subtitle = T('Pathways into the New Testament')}}
{{extend 'layout.html'}}

{{=LOAD('plugin_woh', 'section.load', args=request.args, ajax=False)}}

{{mychap = int(request.args[0]) if request.args else 0}}

{{block right_sidebar}}
<div data-spy='affix' id='sidemenu'>
    <div class="dropdown nav navbar nav-stacked">
    <a id='dropdown-label' data-toggle='dropdown' class='dropdown-toggle'>
        Chapters 
        <b class='caret'></b>
    </a>
    <ul class='dropdown-menu' role="menu" aria-labeledby='dropdown-label'>
    {{for c in sorted(treerefs.keys()):
        row = db.chapter_titles(db.chapter_titles.num == c)
        title = row.title if row else ''
        chnum = '{}. '.format(c) if c not in [0, 999] else ''
        item = LI(A(chnum, title,
                    _href=URL('plugin_woh', 'read',
                              args=[c, treerefs[c][0]])))
        }}
        {{=item}}
    {{pass}}
    </div>

    {{chaptitle = db.chapter_titles(db.chapter_titles.num == mychap).title}}
    {{=H3(chaptitle)}}

    {{submenu = UL(_class='nav nav-pills nav-stacked')
    for c in sorted(treerefs[mychap]):
        row = db((db.section_titles.section_num == c) &
                 (db.section_titles.chapter_num == mychap)).select().first()                
        title = row.title if row else ''
        secnum = '{}. '.format(c) 
        submenu.append(LI(A(secnum, title,
                            _href='#section_{}'.format(c))))
    pass}}
    {{=submenu}}
    <p>{{#include 'plugin_blog/right_sidebar.html'}}</p>
</div>
{{end}}

<script type='text/javascript'>
$('#sidemenu').affix();
</script>
