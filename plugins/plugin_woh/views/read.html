{{
right_sidebar_enabled = 4
left_sidebar_enabled = 0
rightblocks = ['info']
response.title = T('Witnesses of Hope')
response.mobiletitle = response.title
response.subtitle = T('Pathways into the New Testament')
# create dedicated woh menu for nav bar
chapitems = []
for c in sorted(treerefs.keys()):
    row = db.chapter_titles(db.chapter_titles.num == c)
    title = row.title if row else ''
    cnum = '{}. '.format(c) if c not in [0, 999] else ''
    title = '{}{}'.format(cnum, title)
    item = (SPAN(T(title), _class=''), False,
            URL('plugin_woh', 'read', args=[c, treerefs[c][0]]), [],)
    chapitems.append(item)
pass
if auth.has_membership('administrators'):
    editems = []
    for e in ['chapter_titles', 'section_titles', 'paragraphs',
            'woh_images', 'woh_audio']:
        i = (SPAN(T(' {}'.format(e.replace('_', ' ').upper())), _class='icon-cog'),
            False,
            URL('plugin_blog', 'editing', args=[e]),
            [])
        editems.append(i)
    pass
else:
    editems = ''
pass
response.menu = [(SPAN(T(' Chapters'), _class='icon-book'),
                  False,
                  URL('#'),
                  chapitems), 
                 (SPAN(T(' Edit'), _class='icon-cog'),
                  False,
                  URL('#'),
                  editems)]}}
{{extend 'layout.html'}}
{{#=========================================================================}}

{{=LOAD('plugin_woh', 'section.load', args=request.args, ajax=False)}}

{{mychap = int(request.args[0]) if request.args else 0}}

{{block right_sidebar}}
<div data-spy='affix' id='sidemenu'>
    {{chaptitle = db.chapter_titles(db.chapter_titles.num == mychap).title}}
    {{=H3(chaptitle)}}
    {{myopts = {'_data-spy': 'affix', '_data-target': '#page'} }}
    {{submenu = UL(_class='nav nav-pills nav-stacked', **myopts)
    for c in sorted(treerefs[mychap]):
        row = db((db.section_titles.section_num == c) &
                 (db.section_titles.chapter_num == mychap)).select().first()                
        title = row.title if row else ''
        secnum = '{}. '.format(c) 
        secrows = db(db.paragraphs.section == c).select()
        try:
            rowaudio = [a for r in secrows for a in r.audio] 
            secaudio = B(_class='icon-audio')
        except TypeError:
            secaudio = ''
        pass
        submenu.append(LI(A(secnum, title,
                            _href='#section_{}'.format(c)),
                          secaudio))
    pass}}
    {{=submenu}}
    <p>{{#include 'plugin_blog/right_sidebar.html'}}</p>
</div>
{{end}}

<script type='text/javascript'>
$('#sidemenu').affix();
</script>
